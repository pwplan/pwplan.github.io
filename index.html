<!DOCTYPE html>
<html lang="de" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
  <title>Powerplan</title>

  <style>
    body {
      margin: 20px;
    }

    .collapsible {
      background-color: #777;
      color: white;
      cursor: pointer;
      padding: 18px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 15px;
    }

    .active,
    .collapsible:hover {
      background-color: #555;
    }

    .content {
      padding: 0 18px;
      display: none;
      overflow: hidden;
      background-color: #f1f1f1;
    }

    p {
      font-family: Arial, Helvetica, Comic Sans MS, Courier;
    }

    h3 {
      font-family: Arial, Helvetica, Comic Sans MS, Courier;
    }

    .footer {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      text-align: center;
    }
  </style>
</head>

<body>
  <h3>Kohlestrom oder Sonne/Wind -- Ihre Entscheidung </h3>
  <button class="collapsible">mehr erfahren ... </button>
  <div class="content">
    <p>
      Wenn Erneuerbare Energien im Überfluss bereitstehen, ist der Strompreis niedrig.
      <br>Schalten sie Ihre Spülmaschine, Ihren Trockner oder die Waschmaschine ein, wenn der Strompreis niedrig ist, dann reduzieren sie den Verbrauch von Kohlestrom um etwa eine Kilowattstunde zugunsten von Sonnen- oder Windstrom.
      <br><br>
      Da der Strompreis (auf Basis der Energie-Prognosen) einen Tag im Voraus feststeht, können Sie die Spülmaschine auf die entsprechende Uhrzeit programmieren.
      <br><br>Eine Million Menschen sparen auf diese Weise <b>täglich</b> knapp <b>360 Tonnen CO2</b> .
      <br><br>
    </p>
  </div>

  <script>
    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.display === "block") {
          content.style.display = "none";
        } else {
          content.style.display = "block";
        }
      });
    }
  </script>

  <center><canvas id="myChart"></canvas></center>
  <br>
  <h3 id="besttime">Bitte aktivieren sie JavaScript in ihrem Browser um diese Seite sehen zu können!</h3><br><br>
  <script>
    var data = {"data":{"14.12.2020-00:00":"34.01","14.12.2020-01:00":"32.23","14.12.2020-02:00":"30.43","14.12.2020-03:00":"25.18","14.12.2020-04:00":"25.92","14.12.2020-05:00":"31.36","14.12.2020-06:00":"36.27","14.12.2020-07:00":"43.97","14.12.2020-08:00":"44.14","14.12.2020-09:00":"45.59","14.12.2020-10:00":"43.44","14.12.2020-11:00":"44.49","14.12.2020-12:00":"42.16","14.12.2020-13:00":"45.55","14.12.2020-14:00":"49.05","14.12.2020-15:00":"54.13","14.12.2020-16:00":"54.00","14.12.2020-17:00":"60.00","14.12.2020-18:00":"59.03","14.12.2020-19:00":"54.78","14.12.2020-20:00":"49.32","14.12.2020-21:00":"44.55","14.12.2020-22:00":"42.22","14.12.2020-23:00":"40.05","15.12.2020-00:00":"37.03","15.12.2020-01:00":"36.54","15.12.2020-02:00":"35.40","15.12.2020-03:00":"34.00","15.12.2020-04:00":"35.28","15.12.2020-05:00":"39.04","15.12.2020-06:00":"42.10","15.12.2020-07:00":"51.54","15.12.2020-08:00":"57.62","15.12.2020-09:00":"57.88","15.12.2020-10:00":"58.10","15.12.2020-11:00":"59.97","15.12.2020-12:00":"59.80","15.12.2020-13:00":"57.66","15.12.2020-14:00":"57.80","15.12.2020-15:00":"57.48","15.12.2020-16:00":"58.94","15.12.2020-17:00":"68.80","15.12.2020-18:00":"58.14","15.12.2020-19:00":"56.20","15.12.2020-20:00":"50.20","15.12.2020-21:00":"49.24","15.12.2020-22:00":"47.35","15.12.2020-23:00":"43.57"},"besttime":"tomorrow-03:00"}

    var time = Object.keys(data.data)
    var price = [];
    for (i = 0; i < time.length; i++) {
      price.push(data.data[time[i]])
    }

    var besttime = "";
    var besthour = data.besttime;
    var d = new Date();

    function getFormattedTime(dt) {
      hour = dt.getHours();
      minute = dt.getMinutes();
      if ((String(hour)).length == 1) hour = '0' + hour;
      if ((String(minute)).length == 1) minute = '0' + minute;
      return hour + ':' + minute;
    }

    if (besthour.replace("today", "") != besthour) {
      aktdate = getFormattedTime(d).split(":")
      besthourtime = besthour.replace("today-", "").split(":")
      diffhour = Number(besthourtime[0]) - Number(aktdate[0])
      diffmin = Number(besthourtime[1]) - Number(aktdate[1])
      besttime = (diffhour + (diffmin / 60)).toFixed(2)
    } else if (besthour.replace("tomorrow", "") != besthour) {
      aktdate = getFormattedTime(d).split(":")
      besthourtime = besthour.replace("tomorrow-", "").split(":")
      diffhour = Number(besthourtime[0]) - Number(aktdate[0])
      diffmin = Number(besthourtime[1]) - Number(aktdate[1])
      besttime = (diffhour + (diffmin / 60) + 24).toFixed(2)
    }

    document.getElementById('besttime').innerHTML = "Beste zeit zum Starten: " + besthour.replace("today-", "Heute ").replace("tomorrow-", "Morgen ") + " (in " + besttime + " Stunden)"
    var ctx = document.getElementById('myChart').getContext('2d');

    document.getElementById('myChart').width = window.outerWidth / 1.2
    document.getElementById('myChart').height = ((window.outerHeight / 1.2) / 1.5)

    window.chartColors = {
      red: 'rgb(255, 99, 132)',
      orange: 'rgb(255, 159, 64)',
      yellow: 'rgb(255, 205, 86)',
      green: 'rgb(75, 192, 192)',
      blue: 'rgb(54, 162, 235)',
      purple: 'rgb(153, 102, 255)',
      grey: 'rgb(201, 203, 207)'
    };

    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: time,
        datasets: [{
          label: 'Preis (€)',
          backgroundColor: window.chartColors.orange,
          borderColor: window.chartColors.yellow,
          data: price,
          fill: false,
        }]
      },
      options: {
        maintainAspectRatio: false,
        responsive: false,
        title: {
          display: true,
          text: 'Power Plan'
        },
        tooltips: {
          mode: 'index',
          intersect: false,
        },
        hover: {
          mode: 'nearest',
          intersect: true
        },
        scales: {
          xAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Uhrzeit (h)'
            }
          }],
          yAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Preis (€)'
            }
          }]
        }
      }
    });
  </script>

  <div class="footer">
    <p>Powerplan | <a href="index.html">Home</a> - <a href="api.html">API</a> </p>
  </div>

</body>

</html>
